*nested,lawn.sas
ODS HTML;ODS GRAPHICS ON;
OPTIONS LS=90 PS=55 nocenter nodate;
DATA LAWN;
INPUT M $ L S $ DEM Y @@;
CARDS;

1 1 L 1 211  1 1 L 2 230  1 1 H 1 278  1 1 H 2 278
1 2 L 1 184  1 2 L 2 188  1 2 H 1 249  1 2 H 2 272
1 3 L 1 216  1 3 L 2 232  1 3 H 1 275  1 3 H 2 271
2 4 L 1 205  2 4 L 2 217  2 4 H 1 247  2 4 H 2 251
2 5 L 1 169  2 5 L 2 168  2 5 H 1 239  2 5 H 2 252
2 6 L 1 200  2 6 L 2 187  2 6 H 1 261  2 6 H 2 242
3 7 L 1 195  3 7 L 2 207  3 7 H 1 227  3 7 H 2 231
3 8 L 1 199  3 8 L 2 198  3 8 H 1 259  3 8 H 2 282
3 9 L 1 203  3 9 L 2 197  3 9 H 1 251  3 9 H 2 222

PROC GLM;
CLASS S M L DEM;
MODEL Y = M S M*S L(M) S*L(M);
RANDOM L(M) S*L(M)/TEST;
MEANS M S S*M/TUKEY;
LSMEANS M S S*M/STDERR PDIFF ADJUST =TUKEY;
RUN;

PROC MIXED CL ALPHA=.05 COVTEST;
CLASS S M L DEM;
MODEL Y = M S M*S/RESIDUALS DDFM=KR;
RANDOM L(M) S*L(M);
LSMEANS M S M*S/ADJUST=TUKEY;
RUN;

proc glimmix data=LAWN;
CLASS S M L DEM;
MODEL Y = M S M*S;
RANDOM L(M) S*L(M);
lsmeans M S M*S /  plot = meanplot cl;
RUN;
ods graphics off; ods html close;
